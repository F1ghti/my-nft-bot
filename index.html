<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gift NFT Bot</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background: #0b1120; color: white; overflow: hidden; height: 100vh; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1); }
        #main-slider { display: flex; transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1); width: 400%; height: calc(100vh - 180px); }
        .tab-content { width: 100vw; height: 100%; overflow-y: auto; padding: 20px; flex-shrink: 0; }
        .nav-btn { opacity: 0.4; transition: 0.3s; }
        .nav-btn.active { opacity: 1; filter: drop-shadow(0 0 8px #3b82f6); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 5000; align-items: center; justify-content: center; padding: 20px; }
    </style>
</head>
<body class="flex flex-col">

    <div class="p-4 flex justify-between items-center glass m-4 rounded-3xl z-50">
        <div class="flex items-center gap-3">
            <div id="u-no-pic" class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center font-bold shadow-lg">?</div>
            <div>
                <p id="u-name" class="font-bold text-sm leading-none">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                <p class="text-[9px] text-blue-400 font-bold uppercase mt-1">Elite Member</p>
            </div>
        </div>
        <div class="text-right">
            <p id="balance" class="text-yellow-400 font-black text-xl">0 üíé</p>
        </div>
    </div>

    <div id="main-slider">
        <div class="tab-content flex flex-col items-center justify-center text-center">
            <img src="https://api.dicebear.com/7.x/shapes/svg?seed=case" class="w-48 h-48 mb-6 drop-shadow-2xl">
            <h2 class="text-3xl font-black uppercase italic">Cyber Case</h2>
            <p class="text-gray-500 text-xs mb-8">–ù–ê–ñ–ú–ò –ù–ê –ö–ï–ô–°, –ß–¢–û–ë–´ –£–í–ò–î–ï–¢–¨ –î–†–û–ü</p>
            <button onclick="startSpin()" class="bg-blue-600 px-16 py-5 rounded-[30px] text-2xl font-black active:scale-95 transition-all">100 üíé</button>
        </div>
        <div class="tab-content"><h2>–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</h2></div>
        <div class="tab-content"><div id="inv-grid" class="grid grid-cols-2 gap-4"></div></div>
        <div class="tab-content"><div id="top-list" class="space-y-3"></div></div>
    </div>

    <div class="fixed bottom-6 left-6 right-6 h-20 glass rounded-[35px] flex justify-around items-center z-[1000]">
        <button onclick="goToTab(0)" id="btn-0" class="nav-btn active text-2xl">üì¶</button>
        <button onclick="goToTab(1)" id="btn-1" class="nav-btn text-2xl">üõí</button>
        <button onclick="goToTab(2)" id="btn-2" class="nav-btn text-2xl">üéí</button>
        <button onclick="goToTab(3)" id="btn-3" class="nav-btn text-2xl">üèÜ</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –¢–≤–æ—è —Å—Å—ã–ª–∫–∞ ngrok
        const SERVER_URL = "https://12eaff4f4782.ngrok-free.app";
        const user = tg.initDataUnsafe.user || { id: 12345, first_name: "–ò–≥—Ä–æ–∫" };

        async function api(path, body = null) {
            try {
                const opt = {
                    method: body ? 'POST' : 'GET',
                    headers: {
                        "Content-Type": "application/json",
                        "ngrok-skip-browser-warning": "69420" // –ú–ê–ì–ò–ß–ï–°–ö–ò–ô –ó–ê–ì–û–õ–û–í–û–ö –î–õ–Ø NGROK
                    }
                };
                if(body) opt.body = JSON.stringify(body);
                
                const res = await fetch(SERVER_URL + path, opt);
                if (!res.ok) throw new Error();
                return await res.json();
            } catch(e) {
                console.error(e);
                return null;
            }
        }

        async function sync() {
            const d = await api(`/get_user?user_id=${user.id}&username=${encodeURIComponent(user.first_name)}`);
            if(!d) {
                document.getElementById('u-name').innerText = "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏";
                return;
            }
            document.getElementById('balance').innerText = (d.balance || 0).toLocaleString() + " üíé";
            document.getElementById('u-name').innerText = user.first_name;
            
            const grid = document.getElementById('inv-grid');
            if(d.inventory) {
                grid.innerHTML = d.inventory.map(i => `<div class="glass p-4 rounded-2xl text-center"><p class="text-xs font-bold">${i}</p></div>`).join('');
            }
        }

        function goToTab(idx) {
            document.getElementById('main-slider').style.transform = `translateX(-${idx * 100}vw)`;
            document.querySelectorAll('.nav-btn').forEach((b, i) => b.classList.toggle('active', i === idx));
        }

        async function startSpin() {
            const res = await api('/open_case', {user_id: user.id});
            if(!res || !res.success) return tg.showAlert(res ? res.error : "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏");
            tg.showAlert("–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: " + res.item);
            sync();
        }

        window.onload = sync;
    </script>
</body>
</html>
